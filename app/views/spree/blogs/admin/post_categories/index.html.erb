<%= render :partial => 'spree/blogs/admin/shared/post_tabs', :locals => {:current => "Categories"} %>

<div id="categories-box">
  <%= form_for([:admin, @post]) do |f| %>
    <fieldset>
      <legend><%= t('.manage_categories') %></legend>
      <table class="index">
        <% @post_categories.each_with_index do |category, index| -%>
          <tr id="<%= dom_id(category) %>" class="<%= cycle('even', 'odd') %>">
            <td>
              <%= check_box_tag "post[post_category_ids][]", category.id, @post.post_categories.include?(category), :id => "post_category_id_#{index}" -%>
              <%= label_tag "post_category_id_#{index}", category.name -%>
            </td>
            <td class="actions align-center">
              <%= link_to_edit_url edit_admin_post_category_url(@post, category.id), title: "admin_edit_#{dom_id(category)}", no_text: true %>
              <%= link_to_delete category, {:url => admin_post_category_url(@post, category.id), no_text: true} %>
            </td>
          </tr>
        <% end -%>
      </table>
      <%= hidden_field_tag "post[post_category_ids][]", 0 %>
      <%= hidden_field_tag :redirect_to, request.fullpath %>
      <%= button t("update") %>
    </fieldset>
  <% end %>
</div>

<div id="new_category"></div>

<% content_for :page_actions do %>
  <li id="new_category_link">
    <%= button_link_to t('.new_category'), new_object_url, { :icon => 'icon-plus', :id => 'btn_new_category' } %>
  </li>
<% end %>

<% content_for :head do %>
  <script type="text/javascript">
    jQuery(document).ready(function(){

      jQuery('#btn_new_category').click(function (event) {
        event.preventDefault();
        jQuery(this).hide();
        jQuery.ajax({type: 'GET', url: this.href, data: ({authenticity_token: AUTH_TOKEN}), success: function(r){ jQuery('#new_category').html(r);} });
      });

    });
  </script>
<% end %>